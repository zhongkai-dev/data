<div class="d-flex justify-content-between align-items-center mb-4">
    <h2>User Management</h2>
    <div>
        <form action="/admin/users/search" method="GET" class="d-flex">
            <input type="text" name="q" class="form-control me-2" placeholder="Search users...">
            <button type="submit" class="btn btn-outline-primary">Search</button>
        </form>
    </div>
</div>

<div class="card shadow">
    <div class="card-body">
        <div class="table-responsive">
            <table class="table table-hover">
                <thead>
                    <tr>
                        <th>ID</th>
                        <th>Username</th>
                        <th>Name</th>
                        <th>Joined Date</th>
                        <th>Lookups</th>
                        <th>Check Limit</th>
                        <th>Status</th>
                        <th>Actions</th>
                    </tr>
                </thead>
                <tbody>
                    <% users.forEach(user => { %>
                        <tr>
                            <td><%= user.telegram_id %></td>
                            <td><%= user.username || 'N/A' %></td>
                            <td><%= user.first_name %> <%= user.last_name || '' %></td>
                            <td><%= new Date(user.created_at).toLocaleDateString() %></td>
                            <td><%= user.lookup_count || 0 %></td>
                            <td>
                                <span class="badge bg-info">
                                    <%= user.check_limit || 10 %> / day
                                </span>
                                <% if (user.daily_checks && user.daily_checks > 0) { %>
                                    <span class="badge bg-warning ms-1">
                                        <%= user.daily_checks %> used
                                    </span>
                                <% } %>
                            </td>
                            <td>
                                <span class="badge <%= user.is_blocked ? 'bg-danger' : 'bg-success' %>">
                                    <%= user.is_blocked ? 'Blocked' : 'Active' %>
                                </span>
                            </td>
                            <td>
                                <div class="btn-group">
                                    <form action="/admin/toggle-user/<%= user.telegram_id %>" method="POST" class="d-inline">
                                        <button type="submit" class="btn btn-sm <%= user.is_blocked ? 'btn-success' : 'btn-danger' %>">
                                            <%= user.is_blocked ? 'Unblock' : 'Block' %>
                                        </button>
                                    </form>
                                    <a href="/admin/users/<%= user.telegram_id %>" class="btn btn-sm btn-primary ms-1">Details</a>
                                </div>
                            </td>
                        </tr>
                    <% }); %>
                </tbody>
            </table>
        </div>
        
        <% if (pagination.totalPages > 1) { %>
            <nav aria-label="User pagination">
                <ul class="pagination justify-content-center">
                    <li class="page-item <%= pagination.currentPage === 1 ? 'disabled' : '' %>">
                        <a class="page-link" href="/admin/users?page=<%= pagination.currentPage - 1 %>">Previous</a>
                    </li>
                    
                    <% for(let i = 1; i <= pagination.totalPages; i++) { %>
                        <li class="page-item <%= pagination.currentPage === i ? 'active' : '' %>">
                            <a class="page-link" href="/admin/users?page=<%= i %>"><%= i %></a>
                        </li>
                    <% } %>
                    
                    <li class="page-item <%= pagination.currentPage === pagination.totalPages ? 'disabled' : '' %>">
                        <a class="page-link" href="/admin/users?page=<%= pagination.currentPage + 1 %>">Next</a>
                    </li>
                </ul>
            </nav>
        <% } %>
    </div>
</div> 