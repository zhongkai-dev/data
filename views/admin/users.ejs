<div class="d-flex justify-content-between align-items-center mb-4">
    <h2>User Management</h2>
    <div>
        <form action="/admin/users/search" method="GET" class="d-flex">
            <input type="text" name="q" class="form-control me-2" placeholder="Search users...">
            <button type="submit" class="btn btn-outline-primary">Search</button>
        </form>
    </div>
</div>

<!-- Display messages -->
<% if (typeof error !== 'undefined' && error) { %>
    <div class="alert alert-danger alert-dismissible fade show mb-4">
        <%= error %>
        <button type="button" class="btn-close" data-bs-dismiss="alert" aria-label="Close"></button>
    </div>
<% } %>

<% if (typeof success !== 'undefined' && success) { %>
    <div class="alert alert-success alert-dismissible fade show mb-4">
        <%= success %>
        <button type="button" class="btn-close" data-bs-dismiss="alert" aria-label="Close"></button>
    </div>
<% } %>

<!-- Default Daily Limit Card -->
<div class="card shadow mb-4">
    <div class="card-header bg-primary text-white">
        <h5 class="mb-0">Global Default Daily Limit</h5>
    </div>
    <div class="card-body">
        <form action="/admin/users/update-default-limit" method="POST" class="d-flex align-items-center">
            <div class="input-group me-3" style="max-width: 250px;">
                <span class="input-group-text">Default Limit</span>
                <input type="number" name="default_limit" class="form-control" value="<%= defaultLimit || 1000 %>" min="1" required>
                <span class="input-group-text">checks / day</span>
            </div>
            <button type="submit" class="btn btn-primary">
                <i class="bi bi-check-all"></i> Update All Users
            </button>
            <small class="ms-3 text-muted">
                This will set the daily check limit for all users at once.
            </small>
        </form>
    </div>
</div>

<!-- Admin Contact Card -->
<div class="card shadow mb-4">
    <div class="card-header bg-info text-white">
        <h5 class="mb-0">Administrator Contact</h5>
    </div>
    <div class="card-body">
        <p class="mb-2">For inquiries regarding user blocks, daily limits, or other bot administrative issues, please contact:</p>
        <ul class="list-unstyled">
            <li><i class="bi bi-envelope me-2"></i>Email: <a href="mailto:admin@phonelocater.com">admin@phonelocater.com</a></li>
            <li><i class="bi bi-telegram me-2"></i>Telegram: <a href="https://t.me/phonelocateradmin" target="_blank">@phonelocateradmin</a></li>
        </ul>
    </div>
</div>

<div class="card shadow">
    <div class="card-body">
        <div class="table-responsive">
            <table class="table table-hover">
                <thead>
                    <tr>
                        <th>ID</th>
                        <th>Username</th>
                        <th>Name</th>
                        <th>Joined Date</th>
                        <th>Lookups</th>
                        <th>Check Limit</th>
                        <th>Status</th>
                        <th>Actions</th>
                    </tr>
                </thead>
                <tbody>
                    <% users.forEach(user => { %>
                        <tr>
                            <td><%= user.telegram_id %></td>
                            <td><%= user.username || 'N/A' %></td>
                            <td><%= user.first_name %> <%= user.last_name || '' %></td>
                            <td><%= new Date(user.created_at).toLocaleDateString() %></td>
                            <td><%= user.lookup_count || 0 %></td>
                            <td>
                                <span class="badge bg-info">
                                    <%= user.check_limit || 1000 %> / day
                                </span>
                                <% if (user.daily_checks && user.daily_checks > 0) { %>
                                    <span class="badge bg-warning ms-1">
                                        <%= user.daily_checks %> used
                                    </span>
                                <% } %>
                            </td>
                            <td>
                                <span class="badge <%= user.is_blocked ? 'bg-danger' : 'bg-success' %>">
                                    <%= user.is_blocked ? 'Blocked' : 'Active' %>
                                </span>
                            </td>
                            <td>
                                <div class="btn-group">
                                    <form action="/admin/toggle-user/<%= user.telegram_id %>" method="POST" class="d-inline">
                                        <button type="submit" class="btn btn-sm <%= user.is_blocked ? 'btn-success' : 'btn-danger' %>">
                                            <%= user.is_blocked ? 'Unblock' : 'Block' %>
                                        </button>
                                    </form>
                                    <a href="/admin/users/<%= user.telegram_id %>" class="btn btn-sm btn-primary ms-1">Details</a>
                                </div>
                            </td>
                        </tr>
                    <% }); %>
                </tbody>
            </table>
        </div>
        
        <% if (pagination.totalPages > 1) { %>
            <nav aria-label="User pagination">
                <ul class="pagination justify-content-center">
                    <li class="page-item <%= pagination.currentPage === 1 ? 'disabled' : '' %>">
                        <a class="page-link" href="/admin/users?page=<%= pagination.currentPage - 1 %>">Previous</a>
                    </li>
                    
                    <% for(let i = 1; i <= pagination.totalPages; i++) { %>
                        <li class="page-item <%= pagination.currentPage === i ? 'active' : '' %>">
                            <a class="page-link" href="/admin/users?page=<%= i %>"><%= i %></a>
                        </li>
                    <% } %>
                    
                    <li class="page-item <%= pagination.currentPage === pagination.totalPages ? 'disabled' : '' %>">
                        <a class="page-link" href="/admin/users?page=<%= pagination.currentPage + 1 %>">Next</a>
                    </li>
                </ul>
            </nav>
        <% } %>
    </div>
</div> 